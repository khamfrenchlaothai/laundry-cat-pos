<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional Point of Sale system for Laundry Cat Vientiane laundromat">
    <meta name="theme-color" content="#16a34a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Laundry Cat">
    <title>Laundry Cat Vientiane - POS</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/images/logo.jpeg">
    <link rel="icon" type="image/jpeg" href="assets/images/logo.jpeg">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script>
        window.react = window.React;
        window.reactDOM = window.ReactDOM;
    </script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="assets/css/styles.css?v=2">
</head>

<body>
    <div id="root"></div>

    <!-- Scripts -->
    <script src="assets/js/database.js"></script>
    <script src="assets/js/auth.js"></script>

    <!-- Login Check -->
    <script>
        if (!Auth.isAuthenticated()) {
            window.location.href = 'login.html';
        }
    </script>

    <!-- Main Application Code (Inline to prevent loading errors) -->
    <script type="text/babel">
        console.log("App starting...");

        // --- ICONS & HELPERS ---
        const LucideIcons = window.lucide || window.LucideReact || {};
        const FallbackIcon = () => React.createElement('span', null, '‚ñ°');

        const {
            LayoutDashboard = FallbackIcon, ShoppingBasket = FallbackIcon, Users = FallbackIcon,
            Package = FallbackIcon, Plus = FallbackIcon, Trash2 = FallbackIcon, Search = FallbackIcon,
            Menu = FallbackIcon, X = FallbackIcon, ChevronRight = FallbackIcon, DollarSign = FallbackIcon,
            CreditCard = FallbackIcon, ChevronUp = FallbackIcon, ChevronDown = FallbackIcon,
            Download = FallbackIcon, Upload = FallbackIcon
        } = LucideIcons;

        const { useState, useEffect, useMemo } = React;

        // --- COMPONENTS ---

        const Sidebar = ({ activeTab, setActiveTab }) => {
            const menuItems = [
                { id: 'pos', label: 'POS', icon: <ShoppingBasket size={24} /> },
                { id: 'items', label: 'Items', icon: <Package size={24} /> },
                { id: 'customers', label: 'Customers', icon: <Users size={24} /> },
                { id: 'dashboard', label: 'Dashboard', icon: <LayoutDashboard size={24} /> },
            ];

            return (
                <div className="w-20 md:w-64 bg-white h-screen shadow-lg flex flex-col fixed left-0 top-0 z-50">
                    <div className="h-16 flex items-center justify-center md:justify-start md:px-6 border-b border-gray-100">
                        <div className="w-8 h-8 rounded-lg flex items-center justify-center mr-0 md:mr-3 overflow-hidden">
                            <img src="assets/images/logo.jpeg" alt="Logo" className="w-full h-full object-cover" />
                        </div>
                        <span className="hidden md:block font-bold text-xl text-gray-800">Laundry Cat Vientiane</span>
                    </div>
                    <nav className="flex-1 py-4">
                        {menuItems.map((item) => (
                            <button
                                key={item.id}
                                onClick={() => setActiveTab(item.id)}
                                className={`w-full flex items-center p-4 transition-colors ${activeTab === item.id
                                    ? 'bg-green-50 text-green-600 border-r-4 border-green-500'
                                    : 'text-gray-500 hover:bg-gray-50 hover:text-gray-800'
                                    }`}
                            >
                                <div className="flex justify-center w-8">{item.icon}</div>
                                <span className="hidden md:block ml-3 font-medium">{item.label}</span>
                            </button>
                        ))}
                    </nav>
                    <div className="border-t border-gray-200 p-4">
                        <div className="hidden md:block mb-2">
                            <p className="text-xs text-gray-500">Logged in as:</p>
                            <p className="text-sm font-medium text-gray-700">{window.Auth?.getCurrentUser() || 'Admin'}</p>
                        </div>
                        <button
                            onClick={() => {
                                if (confirm('Are you sure you want to logout?')) {
                                    window.Auth?.logout();
                                }
                            }}
                            className="w-full flex items-center justify-center md:justify-start p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                        >
                            <Trash2 size={20} />
                            <span className="hidden md:block ml-2 font-medium">Logout</span>
                        </button>
                    </div>
                </div>
            );
        };

        const ProductCard = ({ item, onAdd }) => (
            <div
                onClick={() => onAdd(item)}
                className="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer overflow-hidden flex flex-col h-48"
            >
                <div className="h-32 overflow-hidden bg-gray-100 relative">
                    {item.image ? (
                        <img src={item.image} alt={item.name} className="w-full h-full object-cover" />
                    ) : (
                        <div className="w-full h-full flex items-center justify-center text-gray-400">
                            <Package size={32} />
                        </div>
                    )}
                    <div className="absolute bottom-0 right-0 bg-green-500 text-white px-2 py-1 text-sm font-bold rounded-tl-lg">
                        ${item.price.toLocaleString()}
                    </div>
                </div>
                <div className="p-3 flex-1 flex flex-col justify-center">
                    <h3 className="font-medium text-gray-800 text-sm line-clamp-2">{item.name}</h3>
                </div>
            </div>
        );

        const PaymentModal = ({ total, onConfirm, onCancel }) => {
            const [paymentMethod, setPaymentMethod] = useState('Cash');
            const [printTicket, setPrintTicket] = useState(true);

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden">
                        <div className="p-6 border-b">
                            <h3 className="font-bold text-xl text-center">Payment</h3>
                            <p className="text-center text-3xl font-bold text-green-600 mt-2">${total.toLocaleString()}</p>
                        </div>
                        <div className="p-6 space-y-4">
                            <div className="grid grid-cols-3 gap-3">
                                {['Cash', 'One Pay', 'QR'].map(method => (
                                    <button
                                        key={method}
                                        onClick={() => setPaymentMethod(method)}
                                        className={`py-3 rounded-lg font-medium border-2 transition-all ${paymentMethod === method
                                            ? 'border-green-500 bg-green-50 text-green-700'
                                            : 'border-gray-200 text-gray-600 hover:border-gray-300'
                                            }`}
                                    >
                                        {method}
                                    </button>
                                ))}
                            </div>
                            <label className="flex items-center justify-center gap-2 p-3 bg-gray-50 rounded-lg cursor-pointer">
                                <input
                                    type="checkbox"
                                    checked={printTicket}
                                    onChange={e => setPrintTicket(e.target.checked)}
                                    className="w-5 h-5 text-green-500 rounded focus:ring-green-500"
                                />
                                <span className="font-medium text-gray-700">Print Ticket</span>
                            </label>
                            <div className="grid grid-cols-2 gap-3 pt-2">
                                <button onClick={onCancel} className="py-3 rounded-lg border border-gray-300 font-medium text-gray-600 hover:bg-gray-50">Cancel</button>
                                <button onClick={() => onConfirm(paymentMethod, printTicket)} className="py-3 rounded-lg bg-green-500 text-white font-bold hover:bg-green-600 shadow-lg">Confirm</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Cart = ({ cart, onUpdateQuantity, onRemove, onClear, onCheckout, customers, selectedCustomer, onSelectCustomer }) => {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const [isCustomerModalOpen, setIsCustomerModalOpen] = useState(false);
            const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false);

            return (
                <div className="flex flex-col h-full bg-white border-l border-gray-200">
                    <div className="p-4 border-b border-gray-100">
                        {selectedCustomer ? (
                            <div className="flex items-center justify-between bg-green-50 p-3 rounded-lg border border-green-100">
                                <div className="flex items-center">
                                    <div className="w-8 h-8 bg-green-200 text-green-700 rounded-full flex items-center justify-center font-bold mr-3">{selectedCustomer.name.charAt(0)}</div>
                                    <div><p className="font-medium text-sm text-gray-800">{selectedCustomer.name}</p></div>
                                </div>
                                <button onClick={() => onSelectCustomer(null)} className="text-gray-400 hover:text-red-500"><X size={18} /></button>
                            </div>
                        ) : (
                            <button onClick={() => setIsCustomerModalOpen(true)} className="w-full py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 font-medium hover:border-green-500 hover:text-green-500 transition-colors flex items-center justify-center gap-2">
                                <Users size={18} /> Add Customer to Sale
                            </button>
                        )}
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-3">
                        {cart.length === 0 ? (
                            <div className="h-full flex flex-col items-center justify-center text-gray-400"><ShoppingBasket size={48} className="mb-2 opacity-50" /><p>Cart is empty</p></div>
                        ) : (
                            cart.map((item) => (
                                <div key={item.cartId} className="flex items-center justify-between">
                                    <div className="flex-1">
                                        <h4 className="font-medium text-gray-800">{item.name}</h4>
                                        <p className="text-sm text-gray-500">${item.price.toLocaleString()} x {item.quantity}</p>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <div className="flex items-center border rounded-lg">
                                            <button onClick={() => onUpdateQuantity(item.cartId, item.quantity - 1)} className="p-1 hover:bg-gray-100 text-gray-600">-</button>
                                            <span className="w-8 text-center text-sm font-medium">{item.quantity}</span>
                                            <button onClick={() => onUpdateQuantity(item.cartId, item.quantity + 1)} className="p-1 hover:bg-gray-100 text-gray-600">+</button>
                                        </div>
                                        <div className="text-right w-16 font-medium">${(item.price * item.quantity).toLocaleString()}</div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                    <div className="p-4 bg-gray-50 border-t border-gray-200">
                        <div className="flex justify-between mb-2 text-gray-600"><span>Subtotal</span><span>${total.toLocaleString()}</span></div>
                        <div className="flex justify-between mb-6 text-xl font-bold text-gray-800"><span>Total</span><span>${total.toLocaleString()}</span></div>
                        <div className="grid grid-cols-2 gap-3">
                            <button onClick={onClear} className="py-3 px-4 rounded-lg border border-gray-300 text-gray-600 font-medium hover:bg-gray-100 transition-colors">Clear</button>
                            <button onClick={() => setIsPaymentModalOpen(true)} disabled={cart.length === 0} className={`py-3 px-4 rounded-lg font-bold text-white shadow-lg flex items-center justify-center gap-2 transition-all ${cart.length === 0 ? 'bg-gray-300 cursor-not-allowed' : 'bg-green-500 hover:bg-green-600 hover:shadow-xl'}`}>Charge ${total.toLocaleString()}</button>
                        </div>
                    </div>
                    {isPaymentModalOpen && <PaymentModal total={total} onConfirm={(method, print) => { onCheckout(method, print); setIsPaymentModalOpen(false); }} onCancel={() => setIsPaymentModalOpen(false)} />}
                    {isCustomerModalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
                                <div className="p-4 border-b">
                                    <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-lg">Select Customer</h3><button onClick={() => setIsCustomerModalOpen(false)}><X size={20} /></button></div>
                                    <input type="text" placeholder="Search by name or phone..." className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none" autoFocus onChange={(e) => {
                                        const term = e.target.value.toLowerCase();
                                        const items = document.querySelectorAll('.customer-item');
                                        items.forEach(item => { const text = item.textContent.toLowerCase(); item.style.display = text.includes(term) ? 'flex' : 'none'; });
                                    }} />
                                </div>
                                <div className="p-4 max-h-96 overflow-y-auto">
                                    {customers.map(c => (
                                        <div key={c.id} onClick={() => { onSelectCustomer(c); setIsCustomerModalOpen(false); }} className="customer-item p-3 hover:bg-gray-50 rounded-lg cursor-pointer flex items-center justify-between border-b border-gray-100 last:border-0">
                                            <div><p className="font-medium">{c.name}</p><p className="text-sm text-gray-500">{c.phone}</p></div><ChevronRight size={16} className="text-gray-400" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const StatCard = ({ title, value, icon, color }) => (
            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center">
                <div className={`w-12 h-12 rounded-full flex items-center justify-center text-white mr-4 ${color}`}>{icon}</div>
                <div><p className="text-sm text-gray-500 font-medium">{title}</p><h3 className="text-2xl font-bold text-gray-800">{value}</h3></div>
            </div>
        );

        const CustomerSearch = ({ customers, selectedCustomerId, onSelectCustomer }) => {
            const [query, setQuery] = useState('');
            const [isOpen, setIsOpen] = useState(false);
            const filteredCustomers = useMemo(() => {
                if (!query) return [];
                const lowerQuery = query.toLowerCase();
                return customers.filter(c => c.name.toLowerCase().includes(lowerQuery) || (c.phone && c.phone.includes(lowerQuery))).slice(0, 10);
            }, [customers, query]);
            const handleSelect = (customer) => { onSelectCustomer(customer.id); setQuery(''); setIsOpen(false); };
            const handleClear = () => { onSelectCustomer(''); setQuery(''); };
            const selectedCustomer = customers.find(c => c.id === selectedCustomerId);

            return (
                <div className="relative w-64">
                    {selectedCustomerId ? (
                        <div className="flex items-center justify-between p-2 bg-green-50 border border-green-200 rounded-lg">
                            <div className="flex flex-col"><span className="font-bold text-green-800 text-sm">{selectedCustomer?.name}</span><span className="text-xs text-green-600">{selectedCustomer?.phone}</span></div>
                            <button onClick={handleClear} className="p-1 hover:bg-green-100 rounded-full text-green-600 transition-colors"><X size={16} /></button>
                        </div>
                    ) : (
                        <div className="relative">
                            <div className="relative"><Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={16} /><input type="text" placeholder="Search customer..." className="w-full pl-9 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 outline-none text-sm" value={query} onChange={(e) => { setQuery(e.target.value); setIsOpen(true); }} onFocus={() => setIsOpen(true)} /></div>
                            {isOpen && query && (
                                <div className="absolute top-full left-0 right-0 mt-1 bg-white border rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto">
                                    {filteredCustomers.length > 0 ? (filteredCustomers.map(c => (<button key={c.id} onClick={() => handleSelect(c)} className="w-full text-left p-3 hover:bg-gray-50 border-b border-gray-50 last:border-0 transition-colors"><div className="font-medium text-gray-800">{c.name}</div><div className="text-xs text-gray-500">{c.phone || 'No Phone'}</div></button>))) : (<div className="p-3 text-sm text-gray-400 text-center">No customers found</div>)}
                                </div>
                            )}
                            {isOpen && <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)} />}
                        </div>
                    )}
                </div>
            );
        };

        const Dashboard = ({ sales, onDeleteSale, customers, items, onImportSales, onRestore }) => {
            const [timeFilter, setTimeFilter] = useState('day');
            const [selectedCustomerId, setSelectedCustomerId] = useState('');
            const [sortConfig, setSortConfig] = useState({ key: 'date', direction: 'desc' });

            const handleSort = (key) => {
                let direction = 'asc';
                if (sortConfig.key === key && sortConfig.direction === 'asc') { direction = 'desc'; }
                setSortConfig({ key, direction });
            };

            const getFilteredSales = () => {
                const now = new Date();
                const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const startOfWeek = new Date(now); startOfWeek.setDate(now.getDate() - now.getDay()); startOfWeek.setHours(0, 0, 0, 0);
                const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                return sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    if (timeFilter === 'day') return saleDate >= startOfDay;
                    if (timeFilter === 'week') return saleDate >= startOfWeek;
                    if (timeFilter === 'month') return saleDate >= startOfMonth;
                    return true;
                });
            };

            const filteredSales = getFilteredSales();
            const totalRevenue = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalOrders = filteredSales.length;
            const averageOrder = totalOrders > 0 ? totalRevenue / totalOrders : 0;

            const itemStats = {};
            filteredSales.forEach(sale => { sale.items.forEach(item => { if (!itemStats[item.name]) itemStats[item.name] = 0; itemStats[item.name] += item.quantity; }); });
            const sortedItemStats = Object.entries(itemStats).sort(([, a], [, b]) => b - a);

            const getChartData = () => {
                const data = {};
                if (timeFilter === 'day') { for (let i = 9; i <= 19; i++) data[i + ':00'] = 0; }
                else if (timeFilter === 'week') { ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(d => data[d] = 0); }
                filteredSales.forEach(sale => {
                    const date = new Date(sale.date);
                    let key;
                    if (timeFilter === 'day') key = date.getHours() + ':00';
                    else if (timeFilter === 'week') key = date.toLocaleDateString('en-US', { weekday: 'short' });
                    else key = date.getDate();
                    if (data[key] === undefined) data[key] = 0;
                    data[key] += sale.total;
                });
                return data;
            };

            const chartData = getChartData();
            const maxChartValue = Math.max(...Object.values(chartData), 100000);
            const selectedCustomer = customers ? customers.find(c => c.id === selectedCustomerId) : null;
            const customerSales = selectedCustomer ? sales.filter(s => s.customerId === selectedCustomer.id) : [];
            const customerTotalSpent = customerSales.reduce((sum, s) => sum + s.total, 0);
            const customerTotalOrders = customerSales.length;
            const customerItemStats = {};
            customerSales.forEach(sale => { sale.items.forEach(item => { if (!customerItemStats[item.name]) customerItemStats[item.name] = 0; customerItemStats[item.name] += item.quantity; }); });

            const sortedSales = [...sales].sort((a, b) => {
                if (sortConfig.key === 'date') return sortConfig.direction === 'asc' ? new Date(a.date) - new Date(b.date) : new Date(b.date) - new Date(a.date);
                else if (sortConfig.key === 'id') return sortConfig.direction === 'asc' ? a.id - b.id : b.id - a.id;
                return 0;
            });

            return (
                <div className="p-6 md:p-8 max-w-7xl mx-auto">
                    <div className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                        <div className="flex items-center gap-4">
                            <h2 className="text-2xl font-bold text-gray-800">Dashboard</h2>
                            <button onClick={() => { if (confirm('Load demo sales data?')) { const demoSales = []; const today = new Date(); for (let i = 0; i < 50; i++) { const date = new Date(today); date.setDate(today.getDate() - Math.floor(Math.random() * 30)); const numItems = Math.floor(Math.random() * 5) + 1; const saleItems = []; let total = 0; for (let j = 0; j < numItems; j++) { const item = items[Math.floor(Math.random() * items.length)]; if (item) { saleItems.push({ ...item, quantity: 1 }); total += item.price; } } if (saleItems.length > 0) { demoSales.push({ id: Date.now() - Math.floor(Math.random() * 10000000), date: date.toISOString(), items: saleItems, total: total, paymentMethod: Math.random() > 0.5 ? 'Cash' : 'One Pay', customerName: Math.random() > 0.7 ? 'Walk-in' : 'Regular' }); } } onImportSales(demoSales); } }} className="text-xs bg-purple-50 hover:bg-purple-100 text-purple-600 px-3 py-1.5 rounded border border-purple-200 transition-colors">Load Demo Data</button>
                        </div>
                        <div className="flex items-center gap-4">
                            <CustomerSearch customers={customers} selectedCustomerId={selectedCustomerId} onSelectCustomer={setSelectedCustomerId} />
                            {!selectedCustomerId && (
                                <div className="flex bg-white rounded-lg shadow-sm border border-gray-200 p-1">
                                    {['day', 'week', 'month'].map(t => (<button key={t} onClick={() => setTimeFilter(t)} className={`px-4 py-2 rounded-md text-sm font-medium capitalize transition-colors ${timeFilter === t ? 'bg-green-500 text-white shadow-sm' : 'text-gray-600 hover:bg-gray-50'}`}>{t}</button>))}
                                </div>
                            )}
                        </div>
                    </div>
                    {selectedCustomerId && selectedCustomer ? (
                        <div className="space-y-6">
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col md:flex-row justify-between items-center">
                                <div><h3 className="text-2xl font-bold text-gray-800">{selectedCustomer.name}</h3><p className="text-gray-500">{selectedCustomer.phone || 'No Phone'}</p><p className="text-xs text-gray-400 font-mono mt-1">ID: {selectedCustomer.id}</p></div>
                                <div className="flex gap-8 mt-4 md:mt-0 text-right"><div><p className="text-gray-500 text-sm">Total Spent</p><p className="text-xl font-bold text-green-600">${customerTotalSpent.toLocaleString()}</p></div><div><p className="text-gray-500 text-sm">Total Orders</p><p className="text-xl font-bold text-blue-600">{customerTotalOrders}</p></div></div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6"><h3 className="font-bold text-lg text-gray-800 mb-4">Service & Product Usage</h3><div className="space-y-6 overflow-y-auto h-64">{Object.keys(customerItemStats).length === 0 ? (<div className="text-center text-gray-400 py-10">No usage history</div>) : (Object.entries(Object.entries(customerItemStats).reduce((acc, [name, quantity]) => { const item = items.find(i => i.name === name); const category = item ? item.category : 'Other'; if (!acc[category]) acc[category] = []; acc[category].push({ name, quantity }); return acc; }, {})).map(([category, items]) => (<div key={category}><h4 className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">{category}</h4><div className="space-y-2">{items.sort((a, b) => b.quantity - a.quantity).map(({ name, quantity }) => (<div key={name} className="flex items-center justify-between text-sm"><span className="text-gray-700">{name}</span><span className="font-bold text-green-600">{quantity}</span></div>))}</div></div>)))}</div></div>
                                <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"><div className="p-6 border-b border-gray-100"><h3 className="font-bold text-lg text-gray-800">Purchase History</h3></div><div className="overflow-y-auto h-64"><table className="w-full text-left"><thead className="bg-gray-50 text-gray-500 text-sm sticky top-0"><tr><th className="p-4 font-medium">ID</th><th className="p-4 font-medium">Date</th><th className="p-4 font-medium">Items</th><th className="p-4 font-medium text-right">Total</th></tr></thead><tbody className="divide-y divide-gray-100">{customerSales.slice().reverse().map((sale) => (<tr key={sale.id} className="hover:bg-gray-50"><td className="p-4 text-gray-500 font-mono text-xs">#{sale.id}</td><td className="p-4 text-gray-600 text-sm">{new Date(sale.date).toLocaleString()}</td><td className="p-4 text-gray-600 text-sm">{sale.items.length} items</td><td className="p-4 text-right font-bold text-green-600 text-sm">${sale.total.toLocaleString()}</td></tr>))}{customerSales.length === 0 && (<tr><td colSpan="4" className="p-8 text-center text-gray-400">No purchases found</td></tr>)}</tbody></table></div></div>
                            </div>
                        </div>
                    ) : (
                        <>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><StatCard title="Total Revenue" value={`$${totalRevenue.toLocaleString()}`} icon={<DollarSign size={24} />} color="bg-green-500" /><StatCard title="Total Orders" value={totalOrders} icon={<ShoppingBasket size={24} />} color="bg-blue-500" /><StatCard title="Average Order" value={`$${averageOrder.toLocaleString()}`} icon={<CreditCard size={24} />} color="bg-purple-500" /></div>
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6"><h3 className="font-bold text-lg text-gray-800 mb-4">Sales Overview</h3><div className="h-64 flex relative pl-12 pb-6"><div className="absolute left-0 top-0 bottom-6 w-10 flex flex-col justify-between text-xs text-gray-400 text-right pr-2"><span>{(maxChartValue).toLocaleString()}</span><span>{(maxChartValue * 0.75).toLocaleString()}</span><span>{(maxChartValue * 0.5).toLocaleString()}</span><span>{(maxChartValue * 0.25).toLocaleString()}</span><span>0</span></div><div className="absolute left-12 right-0 top-0 bottom-6 flex flex-col justify-between pointer-events-none"><div className="border-b border-gray-100 w-full h-0"></div><div className="border-b border-gray-100 w-full h-0"></div><div className="border-b border-gray-100 w-full h-0"></div><div className="border-b border-gray-100 w-full h-0"></div><div className="border-b border-gray-200 w-full h-0"></div></div><div className="flex-1 flex items-end gap-2 z-10 h-full">{Object.entries(chartData).length === 0 ? (<div className="w-full h-full flex items-center justify-center text-gray-400">No data for this period</div>) : (Object.entries(chartData).map(([key, value]) => (<div key={key} className="flex-1 flex flex-col items-center group h-full justify-end"><div className="w-full bg-green-200 rounded-t-sm hover:bg-green-300 transition-all relative" style={{ height: `${(value / maxChartValue) * 100}%` }}><div className="absolute bottom-full mb-1 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-20">${value.toLocaleString()}</div></div><span className="absolute bottom-0 text-xs text-gray-500 mt-2 truncate w-full text-center">{key}</span></div>)))}</div></div></div>
                                <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6"><h3 className="font-bold text-lg text-gray-800 mb-4">Top Items</h3><div className="space-y-4 overflow-y-auto h-64">{sortedItemStats.length === 0 ? (<div className="text-center text-gray-400 py-10">No items sold</div>) : (sortedItemStats.map(([name, quantity], index) => (<div key={name} className="flex items-center justify-between"><div className="flex items-center gap-3"><div className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-gray-500 text-sm">{index + 1}</div><span className="font-medium text-gray-700">{name}</span></div><span className="font-bold text-green-600">{quantity} sold</span></div>)))}</div></div>
                            </div>
                            <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"><div className="p-6 border-b border-gray-100"><h3 className="font-bold text-lg text-gray-800">Recent Sales</h3></div><div className="overflow-x-auto"><table className="w-full text-left"><thead className="bg-gray-50 text-gray-500 text-sm"><tr><th className="p-4 font-medium cursor-pointer hover:bg-gray-100 transition-colors" onClick={() => handleSort('date')}><div className="flex items-center gap-1">Date{sortConfig.key === 'date' && (sortConfig.direction === 'asc' ? <ChevronUp size={14} /> : <ChevronDown size={14} />)}</div></th><th className="p-4 font-medium cursor-pointer hover:bg-gray-100 transition-colors" onClick={() => handleSort('id')}><div className="flex items-center gap-1">ID{sortConfig.key === 'id' && (sortConfig.direction === 'asc' ? <ChevronUp size={14} /> : <ChevronDown size={14} />)}</div></th><th className="p-4 font-medium">Customer ID</th><th className="p-4 font-medium">Customer</th><th className="p-4 font-medium">Items</th><th className="p-4 font-medium text-right">Total</th><th className="p-4 font-medium text-right">Action</th></tr></thead><tbody className="divide-y divide-gray-100">{sortedSales.map((sale) => (<tr key={sale.id} className="hover:bg-gray-50"><td className="p-4 text-gray-600">{new Date(sale.date).toLocaleString()}</td><td className="p-4 text-gray-500 font-mono text-xs">#{sale.id}</td><td className="p-4 text-gray-500 font-mono text-xs">{sale.customerId ? sale.customerId : '-'}</td><td className="p-4 font-medium text-gray-800">{sale.customerName || 'Guest'}</td><td className="p-4 text-gray-600">{sale.items.length} items</td><td className="p-4 text-right font-bold text-green-600">${sale.total.toLocaleString()}</td><td className="p-4 text-right"><button onClick={() => onDeleteSale(sale.id)} className="text-red-400 hover:text-red-600 p-1 rounded-full hover:bg-red-50 transition-colors" title="Delete Sale"><Trash2 size={18} /></button></td></tr>))}{sales.length === 0 && (<tr><td colSpan="7" className="p-8 text-center text-gray-400">No sales yet</td></tr>)}</tbody></table></div></div>
                            <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mt-8"><h3 className="font-bold text-lg text-gray-800 mb-4">üì¶ Data Backup & Restore</h3><p className="text-gray-600 text-sm mb-4">Export your data for backup or import from a previous backup file.</p><div className="flex gap-4"><button onClick={async () => { try { const data = await DataStore.exportData(); const dataStr = JSON.stringify(data, null, 2); const dataBlob = new Blob([dataStr], { type: 'application/json' }); const url = URL.createObjectURL(dataBlob); const link = document.createElement('a'); link.href = url; link.download = `laundry-cat-backup-${new Date().toISOString().split('T')[0]}.json`; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); alert('‚úÖ Data exported successfully!'); } catch (error) { console.error('Export failed:', error); alert('‚ùå Export failed. Please try again.'); } }} className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium flex items-center gap-2 transition-colors"><Download size={20} /> Export Data</button><label className="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium flex items-center gap-2 cursor-pointer transition-colors"><Upload size={20} /> Import Data<input type="file" accept=".json" className="hidden" onChange={async (e) => { const file = e.target.files[0]; if (!file) return; if (confirm('‚ö†Ô∏è This will replace ALL current data. Continue?')) { try { const text = await file.text(); const data = JSON.parse(text); await onRestore(data); } catch (error) { console.error('Import failed:', error); alert('‚ùå Invalid backup file.'); } } }} /></label></div></div>
                        </>
                    )}
                </div>
            );
        };

        const ItemsManager = ({ items, onSaveItem, onDeleteItem }) => {
            const [editingItem, setEditingItem] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const handleEdit = (item) => { setEditingItem(item); setIsModalOpen(true); };
            const handleAddNew = () => { setEditingItem(null); setIsModalOpen(true); };

            return (
                <div className="p-6">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold text-gray-800">Items Manager</h2><button onClick={handleAddNew} className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2"><Plus size={20} /> Add New Item</button></div>
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"><table className="w-full text-left"><thead className="bg-gray-50 text-gray-500 text-sm"><tr><th className="p-4">Image</th><th className="p-4">Name</th><th className="p-4">Category</th><th className="p-4">Price</th><th className="p-4 text-right">Actions</th></tr></thead><tbody className="divide-y divide-gray-100">{items.map(item => (<tr key={item.id} className="hover:bg-gray-50"><td className="p-4"><div className="w-12 h-12 bg-gray-100 rounded-lg overflow-hidden">{item.image ? (<img src={item.image} alt="" className="w-full h-full object-cover" />) : (<div className="w-full h-full flex items-center justify-center text-gray-400"><Package size={20} /></div>)}</div></td><td className="p-4 font-medium">{item.name}</td><td className="p-4 text-gray-500"><span className="px-2 py-1 bg-gray-100 rounded-full text-xs">{item.category}</span></td><td className="p-4 font-bold text-green-600">${item.price.toLocaleString()}</td><td className="p-4 text-right"><button onClick={() => handleEdit(item)} className="text-blue-500 hover:text-blue-700 mr-3">Edit</button><button onClick={() => onDeleteItem(item.id)} className="text-red-500 hover:text-red-700">Delete</button></td></tr>))}</tbody></table></div>
                    {isModalOpen && <ItemModal item={editingItem} onSave={(item) => { onSaveItem(item); setIsModalOpen(false); }} onClose={() => setIsModalOpen(false)} />}
                </div>
            );
        };

        const ItemModal = ({ item, onSave, onClose }) => {
            const [formData, setFormData] = useState(item || { id: Date.now(), name: '', price: '', category: 'Wash', image: '' });
            const handleSubmit = (e) => { e.preventDefault(); onSave({ ...formData, price: Number(formData.price), id: formData.id || Date.now() }); };
            const handleImageUpload = (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onloadend = () => { setFormData({ ...formData, image: reader.result }); }; reader.readAsDataURL(file); } };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
                        <h3 className="font-bold text-xl mb-4">{item ? 'Edit Item' : 'New Item'}</h3>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">Name</label><input required type="text" className="w-full p-2 border rounded-lg" value={formData.name} onChange={e => setFormData({ ...formData, name: e.target.value })} /></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">Price (LAK)</label><input required type="number" className="w-full p-2 border rounded-lg" value={formData.price} onChange={e => setFormData({ ...formData, price: e.target.value })} /></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">Category</label><select className="w-full p-2 border rounded-lg" value={formData.category} onChange={e => setFormData({ ...formData, category: e.target.value })}><option>Wash</option><option>Dry</option><option>Detergent</option><option>Service</option><option>Other</option></select></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">Image</label><input type="file" accept="image/*" onChange={handleImageUpload} className="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100" />{formData.image && (<img src={formData.image} alt="Preview" className="mt-2 h-20 w-20 object-cover rounded-lg" />)}</div>
                            <div className="flex justify-end gap-3 mt-6"><button type="button" onClick={onClose} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button><button type="submit" className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">Save Item</button></div>
                        </form>
                    </div>
                </div>
            );
        };

        const CustomersManager = ({ customers, sales, onSaveCustomer, onDeleteCustomer }) => {
            const [editingCustomer, setEditingCustomer] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const handleEdit = (customer) => { setEditingCustomer(customer); setIsModalOpen(true); };

            return (
                <div className="p-6">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold text-gray-800">Customers</h2><button onClick={() => { setEditingCustomer(null); setIsModalOpen(true); }} className="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2"><Plus size={20} /> Add Customer</button></div>
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"><table className="w-full text-left"><thead className="bg-gray-50 text-gray-500 text-sm"><tr><th className="p-4">Name</th><th className="p-4">Phone</th><th className="p-4">Total Spent</th><th className="p-4 text-right">Actions</th></tr></thead><tbody className="divide-y divide-gray-100">{customers.map(customer => { const totalSpent = sales.filter(s => s.customerId === customer.id).reduce((sum, s) => sum + s.total, 0); return (<tr key={customer.id} className="hover:bg-gray-50"><td className="p-4 font-medium">{customer.name}</td><td className="p-4 text-gray-500">{customer.phone}</td><td className="p-4 font-bold text-green-600">${totalSpent.toLocaleString()}</td><td className="p-4 text-right"><button onClick={() => handleEdit(customer)} className="text-blue-500 hover:text-blue-700 mr-3">Edit</button><button onClick={() => onDeleteCustomer(customer.id)} className="text-red-500 hover:text-red-700">Delete</button></td></tr>); })}</tbody></table></div>
                    {isModalOpen && <CustomerModal customer={editingCustomer} onSave={(c) => { onSaveCustomer(c); setIsModalOpen(false); }} onClose={() => setIsModalOpen(false)} />}
                </div>
            );
        };

        const CustomerModal = ({ customer, onSave, onClose }) => {
            const [formData, setFormData] = useState(customer || { id: Date.now(), name: '', phone: '' });
            const handleSubmit = (e) => { e.preventDefault(); onSave({ ...formData, id: formData.id || Date.now() }); };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
                        <h3 className="font-bold text-xl mb-4">{customer ? 'Edit Customer' : 'New Customer'}</h3>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">Name</label><input required type="text" className="w-full p-2 border rounded-lg" value={formData.name} onChange={e => setFormData({ ...formData, name: e.target.value })} /></div>
                            <div><label className="block text-sm font-medium text-gray-700 mb-1">Phone</label><input type="tel" className="w-full p-2 border rounded-lg" value={formData.phone} onChange={e => setFormData({ ...formData, phone: e.target.value })} /></div>
                            <div className="flex justify-end gap-3 mt-6"><button type="button" onClick={onClose} className="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancel</button><button type="submit" className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">Save Customer</button></div>
                        </form>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---

        const App = () => {
            const [activeTab, setActiveTab] = useState('pos');
            const [items, setItems] = useState([]);
            const [cart, setCart] = useState([]);
            const [customers, setCustomers] = useState([]);
            const [sales, setSales] = useState([]);
            const [selectedCustomer, setSelectedCustomer] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        setLoading(true);
                        const [loadedItems, loadedCustomers, loadedSales] = await Promise.all([
                            DataStore.getItems(), DataStore.getCustomers(), DataStore.getSales()
                        ]);
                        setItems(loadedItems); setCustomers(loadedCustomers); setSales(loadedSales);
                    } catch (error) { console.error('Failed to load data:', error); alert('Failed to load data. Please refresh the page.'); } finally { setLoading(false); }
                };
                loadData();
            }, []);

            const addToCart = (item) => { setCart(prev => { const existing = prev.find(i => i.id === item.id); if (existing) { return prev.map(i => i.id === item.id ? { ...i, quantity: i.quantity + 1 } : i); } return [...prev, { ...item, quantity: 1, cartId: Date.now() }]; }); };
            const updateQuantity = (cartId, newQty) => { if (newQty < 1) { setCart(prev => prev.filter(i => i.cartId !== cartId)); } else { setCart(prev => prev.map(i => i.cartId === cartId ? { ...i, quantity: newQty } : i)); } };
            const clearCart = () => { setCart([]); setSelectedCustomer(null); };

            const generateTicket = (sale, shouldPrint) => {
                const ticketContent = `
                    <!DOCTYPE html><html><head><title>Ticket #${sale.id}</title><style>@page { size: 80mm auto; margin: 0; } body { font-family: monospace; width: 78mm; margin: 0 auto; padding: 5px; font-size: 12px; } .header { text-align: center; border-bottom: 1px dashed #000; padding-bottom: 5px; margin-bottom: 5px; } .header h2 { font-size: 16px; margin: 5px 0; } .header p { margin: 2px 0; } .item { display: flex; justify-content: space-between; margin-bottom: 3px; } .total { border-top: 1px dashed #000; margin-top: 5px; padding-top: 5px; font-weight: bold; text-align: right; font-size: 14px; } .footer { text-align: center; margin-top: 10px; font-size: 10px; } hr { border-top: 1px dashed #000; border-bottom: none; margin: 5px 0; } #print-btn { display: block; width: 100%; padding: 10px; background: #22c55e; color: white; border: none; border-radius: 5px; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 20px; } @media print { #print-btn { display: none; } body { padding: 0; } }</style></head><body><button id="print-btn" onclick="window.print()">üñ®Ô∏è PRINT TICKET</button><div class="header"><h2>Laundry Cat Vientiane</h2><p>Ticket #: ${sale.id}</p><p>Date Issued: ${new Date(sale.date).toLocaleString()}</p><p>Payment: <strong>${sale.paymentMethod}</strong></p></div><div><p>Customer: ${sale.customerName || 'Guest'}</p>${sale.customerId ? `<p>Customer ID: ${sale.customerId}</p>` : ''}${sale.customerPhone ? `<p>Phone: ${sale.customerPhone}</p>` : ''}</div><hr/><div>${sale.items.map(item => `<div class="item"><span>${item.quantity}x ${item.name}</span><span>$${(item.price * item.quantity).toLocaleString()}</span></div>`).join('')}</div><div class="total">Total: $${sale.total.toLocaleString()}</div><div class="footer"><p>Thank you for using our services!</p></div></body></html>
                `;
                const ticketWindow = window.open('', '_blank', 'width=400,height=600');
                if (ticketWindow) { ticketWindow.document.open(); ticketWindow.document.write(ticketContent); ticketWindow.document.close(); } else { alert("Please allow popups to print tickets."); }
            };

            const handleCheckout = async (paymentMethod, shouldPrint) => {
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const sale = { id: Date.now(), date: new Date().toISOString(), items: cart, total: total, customerId: selectedCustomer ? selectedCustomer.id : null, customerName: selectedCustomer ? selectedCustomer.name : null, customerPhone: selectedCustomer ? selectedCustomer.phone : null, paymentMethod: paymentMethod };
                try { await DataStore.addSale(sale); setSales(prev => [...prev, sale]); generateTicket(sale, shouldPrint); clearCart(); } catch (error) { console.error('Failed to save sale:', error); alert('Failed to save sale. Please try again.'); }
            };

            const handleSaveItem = async (item) => { try { let newItems; if (items.find(i => i.id === item.id)) { newItems = items.map(i => i.id === item.id ? item : i); } else { newItems = [...items, item]; } setItems(newItems); await DataStore.saveItems(newItems); } catch (error) { console.error("Failed to save items:", error); alert("Failed to save item! Storage might be full."); const reloadedItems = await DataStore.getItems(); setItems(reloadedItems); } };
            const handleDeleteItem = async (id) => { if (confirm('Are you sure you want to delete this item?')) { const newItems = items.filter(i => i.id !== id); setItems(newItems); await DataStore.saveItems(newItems); } };
            const handleSaveCustomer = async (customer) => { try { let newCustomers; if (customers.find(c => c.id === customer.id)) { newCustomers = customers.map(c => c.id === customer.id ? customer : c); } else { newCustomers = [...customers, customer]; } setCustomers(newCustomers); await DataStore.saveCustomers(newCustomers); } catch (error) { console.error("Failed to save customer:", error); alert("Failed to save customer!"); } };
            const handleDeleteCustomer = async (id) => { if (confirm('Delete this customer?')) { const newCustomers = customers.filter(c => c.id !== id); setCustomers(newCustomers); await DataStore.saveCustomers(newCustomers); } };
            const handleDeleteSale = async (id) => { if (confirm('Are you sure you want to delete this sale?')) { const newSales = sales.filter(s => s.id !== id); setSales(newSales); await DataStore.saveSales(newSales); } };
            const handleImportSales = async (newSales) => { try { const updatedSales = [...sales, ...newSales]; setSales(updatedSales); await DataStore.saveSales(updatedSales); } catch (error) { console.error("Import failed:", error); alert("Failed to import demo data. Storage might be full."); } };
            const handleRestoreData = async (data) => { try { setItems(data.items); setCustomers(data.customers); setSales(data.sales); await DataStore.importData(data); alert("Data restored successfully!"); } catch (error) { console.error("Restore failed:", error); alert("Failed to restore data."); } };

            if (loading) { return (<div className="flex h-screen items-center justify-center bg-gray-100"><div className="text-center"><div className="loading mb-4"></div><p className="text-gray-600">Loading Laundry Cat POS...</p></div></div>); }

            const filteredItems = items.filter(i => i.name.toLowerCase().includes(searchQuery.toLowerCase()) || i.category.toLowerCase().includes(searchQuery.toLowerCase()));

            return (
                <div className="flex h-screen bg-gray-100 overflow-hidden font-sans text-gray-900">
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} />
                    <main className="flex-1 ml-20 md:ml-64 h-full overflow-hidden flex">
                        {activeTab === 'pos' && (
                            <>
                                <div className="flex-1 flex flex-col h-full overflow-hidden">
                                    <div className="h-16 bg-white border-b border-gray-200 flex items-center px-6 justify-between"><h1 className="text-xl font-bold text-gray-800">New Sale</h1><div className="relative w-64"><Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={18} /><input type="text" placeholder="Search items..." className="w-full pl-10 pr-4 py-2 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} /></div></div>
                                    <div className="flex-1 overflow-y-auto p-6"><div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">{filteredItems.map(item => (<ProductCard key={item.id} item={item} onAdd={addToCart} />))}</div></div>
                                </div>
                                <div className="w-96 h-full shadow-xl z-40 bg-white"><Cart cart={cart} onUpdateQuantity={updateQuantity} onRemove={(id) => updateQuantity(id, 0)} onClear={clearCart} onCheckout={handleCheckout} customers={customers} selectedCustomer={selectedCustomer} onSelectCustomer={setSelectedCustomer} /></div>
                            </>
                        )}
                        {activeTab === 'items' && (<div className="flex-1 h-full overflow-y-auto"><ItemsManager items={items} onSaveItem={handleSaveItem} onDeleteItem={handleDeleteItem} /></div>)}
                        {activeTab === 'customers' && (<div className="flex-1 h-full overflow-y-auto"><CustomersManager customers={customers} sales={sales} onSaveCustomer={handleSaveCustomer} onDeleteCustomer={handleDeleteCustomer} /></div>)}
                        {activeTab === 'dashboard' && (<div className="flex-1 h-full overflow-y-auto"><Dashboard sales={sales} onDeleteSale={handleDeleteSale} customers={customers} items={items} onImportSales={handleImportSales} onRestore={handleRestoreData} /></div>)}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <!-- Service Worker UN-Registration (Keep this to kill cache) -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister();
                    console.log('‚ùå Service Worker Unregistered');
                }
            });
        }
    </script>
</body>

</html>